# Contributor: Johannes Matheis <jomat+alpinebuild@jmt.gr>
# Maintainer: Johannes Matheis <jomat+alpinebuild@jmt.gr>
pkgname=wireguard
pkgver=volatile
gitcommit=3f67e6331e8d5f772bb8da3a3ad00bf5209f146a
pkgrel=1
pkgdesc="WireGuard is an extremely simple yet fast and modern VPN that utilizes state-of-the-art cryptography"
url="https://www.wireguard.io/"
arch="all"
license="GPL"
depends=""
makedepends="linux-headers linux-grsec-dev libmnl-dev"
install=""
subpackages="$pkgname-doc"
source="https://git.zx2c4.com/WireGuard/snapshot/WireGuard-${gitcommit}.tar.xz"
builddir="$srcdir/WireGuard-${gitcommit}/src/"

getpkgver() {
	echo ${pkgrel}_git${gitcommit}
}

prepare() {
	local i
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$builddir"
	make KCFLAGS=-fno-pie || return 1
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" INSTALL_MOD_PATH="$pkgdir" install || return 1
}

md5sums="ee7fdfbc3397e847fe2750da794f3a41  WireGuard-3f67e6331e8d5f772bb8da3a3ad00bf5209f146a.tar.xz"
sha256sums="7898e6cd7172dcd400d56cf946d0a1ef87162c370c86effdaf7dc14e68f1a168  WireGuard-3f67e6331e8d5f772bb8da3a3ad00bf5209f146a.tar.xz"
sha512sums="f389e1cf2e7dfe391e563d60b7ba3a650f0b16cc052bc55f6046c7356d0b963a3409bba6c9abdd5765bee310aa3d67c748123d3ff2afaac171be8d5e137a90d3  WireGuard-3f67e6331e8d5f772bb8da3a3ad00bf5209f146a.tar.xz"
