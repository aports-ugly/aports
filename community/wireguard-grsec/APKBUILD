# Contributor: Johannes Matheis <jomat+alpinebuild@jmt.gr>
# Maintainer: Johannes Matheis <jomat+alpinebuild@jmt.gr>
pkgname=wireguard
pkgver=volatile
gitcommit=99b49aef8fdd8de5009682fbee88450bcf77aa98
pkgrel=2
pkgdesc="WireGuard is an extremely simple yet fast and modern VPN that utilizes state-of-the-art cryptography"
url="https://www.wireguard.io/"
arch="all"
license="GPL"
depends=""
makedepends="linux-headers linux-grsec-dev libmnl-dev"
install=""
subpackages="$pkgname-doc"
source="https://git.zx2c4.com/WireGuard/snapshot/WireGuard-${gitcommit}.tar.xz"
builddir="$srcdir/WireGuard-${gitcommit}/src/"

getpkgver() {
	echo ${pkgrel}_git${gitcommit}
}

prepare() {
	local i
	cd "$builddir"
	for i in $source; do
		case $i in
		*.patch) msg $i; patch -p1 -i "$srcdir"/$i || return 1;;
		esac
	done
}

build() {
	cd "$builddir"
	make KCFLAGS=-fno-pie || return 1
}

package() {
	cd "$builddir"
	make DESTDIR="$pkgdir" INSTALL_MOD_PATH="$pkgdir" install || return 1
}

md5sums="399a3f8935de699319ee37780f388212  WireGuard-99b49aef8fdd8de5009682fbee88450bcf77aa98.tar.xz"
sha256sums="6fa4193c3592f9c0c3ef85c216737f5b296746d2f2a7b072c71cb67bad46332d  WireGuard-99b49aef8fdd8de5009682fbee88450bcf77aa98.tar.xz"
sha512sums="1cf9c15aa978c730a1c117ee9c9e4db75bd4e1cbed5908241958b089623c8487fa4543c5c5fe386a0ada276ddd9763c033dc8fdc3c1a29d9287fbd22121e9d0f  WireGuard-99b49aef8fdd8de5009682fbee88450bcf77aa98.tar.xz"
